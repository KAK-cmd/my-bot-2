# bot.py - —Ä–∞–±–æ—á–∏–π –±–æ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–±–µ–∑ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª)
import asyncio
import logging
import os
from datetime import datetime, timedelta
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from config import BOT_TOKEN
from excel_parser import –ü–∞—Ä—Å–µ—Ä–†–∞—Å–ø–∏—Å–∞–Ω–∏—è
import sqlite3

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è - –¢–û–õ–¨–ö–û –≤ –∫–æ–Ω—Å–æ–ª—å
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—Å–µ—Ä
–ø–∞—Ä—Å–µ—Ä = –ü–∞—Ä—Å–µ—Ä–†–∞—Å–ø–∏—Å–∞–Ω–∏—è()

# ============ –ë–ê–ó–ê –î–ê–ù–ù–´–• SQLite ============

class Database:
    def __init__(self, db_name='bot_data.db'):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å
        script_dir = os.path.dirname(os.path.abspath(__file__))
        self.db_name = os.path.join(script_dir, db_name)
        print(f"üìÅ –ë–î –ø–æ –ø—É—Ç–∏: {self.db_name}")
        self.init_db()
    
    def get_connection(self):
        """–°–æ–∑–¥–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö"""
        return sqlite3.connect(self.db_name, timeout=10)
    
    def init_db(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ"""
        try:
            conn = self.get_connection()
            cursor = conn.cursor()
            
            # –¢–∞–±–ª–∏—Ü–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
            cursor.execute('''
                CREATE TABLE IF NOT EXISTS subscribers (
                    user_id INTEGER PRIMARY KEY,
                    username TEXT,
                    first_name TEXT,
                    last_name TEXT,
                    subscribed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
                )
            ''')
            
            conn.commit()
            conn.close()
            print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ë–î: {e}")
    
    def add_subscriber(self, user_id: int, username: str = "", first_name: str = "", last_name: str = ""):
        """–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–∞"""
        try:
            conn = self.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('''
                INSERT OR IGNORE INTO subscribers 
                (user_id, username, first_name, last_name) 
                VALUES (?, ?, ?, ?)
            ''', (user_id, username, first_name, last_name))
            
            conn.commit()
            conn.close()
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫ {user_id}")
            return True
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è {user_id}: {e}")
            return False
    
    def remove_subscriber(self, user_id: int):
        """–£–¥–∞–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–∞"""
        try:
            conn = self.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('DELETE FROM subscribers WHERE user_id = ?', (user_id,))
            
            conn.commit()
            deleted = cursor.rowcount > 0
            conn.close()
            
            if deleted:
                print(f"‚úÖ –£–¥–∞–ª–µ–Ω –ø–æ–¥–ø–∏—Å—á–∏–∫ {user_id}")
            return deleted
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è {user_id}: {e}")
            return False
    
    def get_all_subscribers(self):
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤"""
        try:
            conn = self.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('SELECT user_id FROM subscribers')
            subscribers = [row[0] for row in cursor.fetchall()]
            
            conn.close()
            return subscribers
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {e}")
            return []
    
    def is_subscriber(self, user_id: int):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–º"""
        try:
            conn = self.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('SELECT 1 FROM subscribers WHERE user_id = ?', (user_id,))
            result = cursor.fetchone() is not None
            
            conn.close()
            return result
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ {user_id}: {e}")
            return False
    
    def get_subscribers_count(self):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤"""
        try:
            conn = self.get_connection()
            cursor = conn.cursor()
            
            cursor.execute('SELECT COUNT(*) FROM subscribers')
            count = cursor.fetchone()[0]
            
            conn.close()
            return count
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {e}")
            return 0

# –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ë–î
db = Database()

# ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø–ú–ò ============

–ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–±–æ—Ç–∞ = {}
–ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = {}

# ============ –ö–õ–ê–í–ò–ê–¢–£–†–´ ============

def —Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É():
    """–°–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏"""
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="üìÖ –°–µ–≥–æ–¥–Ω—è"),
                KeyboardButton(text="üìÖ –ó–∞–≤—Ç—Ä–∞")
            ],
            [
                KeyboardButton(text="üîµ –ß–∏—Å–ª–∏—Ç–µ–ª—å"),
                KeyboardButton(text="üî¥ –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å"),
                KeyboardButton(text="üìä –ò–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ")
            ],
            [
                KeyboardButton(text="üîî –†–∞—Å—Å—ã–ª–∫–∞"),
                KeyboardButton(text="‚ùì –ü–æ–º–æ—â—å")
            ],
            [
                KeyboardButton(text="–ü–Ω"),
                KeyboardButton(text="–í—Ç"),
                KeyboardButton(text="–°—Ä"),
                KeyboardButton(text="–ß—Ç"),
                KeyboardButton(text="–ü—Ç"),
                KeyboardButton(text="–°–±"),
                KeyboardButton(text="–í—Å")
            ]
        ],
        resize_keyboard=True,
        input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ"
    )
    return keyboard

# ============ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ============

async def —É–¥–∞–ª–∏—Ç—å_–ø—Ä–µ–¥—ã–¥—É—â–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è(chat_id, user_id):
    """–£–¥–∞–ª—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    if user_id in –ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–±–æ—Ç–∞:
        try:
            await bot.delete_message(chat_id=chat_id, message_id=–ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–±–æ—Ç–∞[user_id])
        except:
            pass
    
    if user_id in –ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
        try:
            await bot.delete_message(chat_id=chat_id, message_id=–ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è[user_id])
        except:
            pass

async def –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message: types.Message, —Ç–µ–∫—Å—Ç: str, reply_markup=None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —É–¥–∞–ª—è—Ç—å—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–π—Å—Ç–≤–∏–∏"""
    user_id = message.from_user.id
    chat_id = message.chat.id
    
    # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    await —É–¥–∞–ª–∏—Ç—å_–ø—Ä–µ–¥—ã–¥—É—â–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è(chat_id, user_id)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    –ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è[user_id] = message.message_id
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞
    –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ = await bot.send_message(chat_id, —Ç–µ–∫—Å—Ç, reply_markup=reply_markup)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞
    –ø–æ—Å–ª–µ–¥–Ω–∏–µ_—Å–æ–æ–±—â–µ–Ω–∏—è_–±–æ—Ç–∞[user_id] = –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ.message_id
    
    return –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ

async def –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–Ω–µ—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message: types.Message, —Ç–µ–∫—Å—Ç: str, reply_markup=None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ù–ï –±—É–¥–µ—Ç —É–¥–∞–ª—è—Ç—å—Å—è"""
    return await bot.send_message(message.chat.id, —Ç–µ–∫—Å—Ç, reply_markup=reply_markup)

async def –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–≤—Å–µ–º(–¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏=None, –¥–ª—è_–¥–∞—Ç—ã=None):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º"""
    –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ = db.get_all_subscribers()
    
    if not –ø–æ–¥–ø–∏—Å—á–∏–∫–∏:
        print("‚ÑπÔ∏è –ù–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤")
        return
    
    # –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏, –¥–ª—è_–¥–∞—Ç—ã=–¥–ª—è_–¥–∞—Ç—ã)
    
    for user_id in –ø–æ–¥–ø–∏—Å—á–∏–∫–∏:
        try:
            await bot.send_message(user_id, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
        except Exception as e:
            print(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å {user_id}: {e}")
            db.remove_subscriber(user_id)

async def –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫_—Ä–∞—Å—Å—ã–ª–∫–∏():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ 7:00"""
    while True:
        now = datetime.now()
        now_moscow = now + timedelta(hours=3)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, 7:00 —É—Ç—Ä–∞
        if now_moscow.hour == 7 and now_moscow.minute == 0:
            print(f"‚è∞ {now.strftime('%H:%M')} - –†–∞—Å—Å—ã–ª–∫–∞!")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
            await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–≤—Å–µ–º(–¥–ª—è_–¥–∞—Ç—ã=now)
            
            await asyncio.sleep(61)
        
        await asyncio.sleep(30)

# ============ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –î–ê–¢ ============

def –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏(–Ω–∞–∑–≤–∞–Ω–∏–µ_–¥–Ω—è, –±–∞–∑–æ–≤–∞—è_–¥–∞—Ç–∞=None):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞—Ç—É –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏"""
    if –±–∞–∑–æ–≤–∞—è_–¥–∞—Ç–∞ is None:
        –±–∞–∑–æ–≤–∞—è_–¥–∞—Ç–∞ = datetime.now()
    
    —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–Ω–æ–º–µ—Ä = –±–∞–∑–æ–≤–∞—è_–¥–∞—Ç–∞.weekday()
    
    # –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
    –¥–Ω–∏_–Ω–æ–º–µ—Ä–∞ = {
        "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫": 0, "–ø–Ω": 0,
        "–≤—Ç–æ—Ä–Ω–∏–∫": 1, "–≤—Ç": 1,
        "—Å—Ä–µ–¥–∞": 2, "—Å—Ä": 2,
        "—á–µ—Ç–≤–µ—Ä–≥": 3, "—á—Ç": 3,
        "–ø—è—Ç–Ω–∏—Ü–∞": 4, "–ø—Ç": 4,
        "—Å—É–±–±–æ—Ç–∞": 5, "—Å–±": 5,
        "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ": 6, "–≤—Å": 6
    }
    
    –Ω–∞–∑–≤–∞–Ω–∏–µ_–¥–Ω—è_–Ω–∏–∂ = –Ω–∞–∑–≤–∞–Ω–∏–µ_–¥–Ω—è.lower()
    –Ω—É–∂–Ω—ã–π_–Ω–æ–º–µ—Ä = –¥–Ω–∏_–Ω–æ–º–µ—Ä–∞.get(–Ω–∞–∑–≤–∞–Ω–∏–µ_–¥–Ω—è_–Ω–∏–∂, —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–Ω–æ–º–µ—Ä)
    
    # –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É
    —Ä–∞–∑–Ω–∏—Ü–∞ = –Ω—É–∂–Ω—ã–π_–Ω–æ–º–µ—Ä - —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–Ω–æ–º–µ—Ä
    
    # –ï—Å–ª–∏ –Ω—É–∂–Ω—ã–π –¥–µ–Ω—å —É–∂–µ –ø—Ä–æ—à–µ–ª –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ, –±–µ—Ä–µ–º –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–µ
    if —Ä–∞–∑–Ω–∏—Ü–∞ <= 0:
        —Ä–∞–∑–Ω–∏—Ü–∞ += 7
    
    return –±–∞–∑–æ–≤–∞—è_–¥–∞—Ç–∞ + timedelta(days=—Ä–∞–∑–Ω–∏—Ü–∞)

# ============ –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê ============

@dp.message(Command("start"))
async def start_cmd(message: types.Message):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    user_id = message.from_user.id
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏
    db.add_subscriber(
        user_id=user_id,
        username=message.from_user.username,
        first_name=message.from_user.first_name,
        last_name=message.from_user.last_name
    )
    
    –∑–∞–≥–æ–ª–æ–≤–æ–∫ = "–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.\n–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
    
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–Ω–µ—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(
        message,
        –∑–∞–≥–æ–ª–æ–≤–æ–∫,
        reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É()
    )

@dp.message(Command("help"))
async def help_cmd(message: types.Message):
    —Ç–µ–∫—Å—Ç = (
        "üìö **–ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:**\n\n"
        "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã:\n"
        "/today - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
        "/tomorrow - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n"
        "/week - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–µ\n"
        "/numer - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —á–∏—Å–ª–∏—Ç–µ–ª—è\n"
        "/denom - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è\n"
        "/subscribe - –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É\n"
        "/unsubscribe - –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏\n\n"
        "üîî **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞:**\n"
        "‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 7:00 - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –¥–µ–Ω—å\n"
        "**–ö–Ω–æ–ø–∫–∏:**\n"
        "‚Ä¢ üìÖ –°–µ–≥–æ–¥–Ω—è/–ó–∞–≤—Ç—Ä–∞ - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ\n"
        "‚Ä¢ üîµ –ß–∏—Å–ª–∏—Ç–µ–ª—å/üî¥ –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∫–∞–∑\n"
        "‚Ä¢ üìä –ò–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ - –¥–µ—Ç–∞–ª–∏ –Ω–µ–¥–µ–ª–∏\n"
        "‚Ä¢ üîî –†–∞—Å—Å—ã–ª–∫–∞ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π\n"
        "‚Ä¢ –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å"
    )
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("today"))
async def today_cmd(message: types.Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å()
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("tomorrow"))
async def tomorrow_cmd(message: types.Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"""
    –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞ = datetime.now() + timedelta(days=1)
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
    –∑–∞–≤—Ç—Ä–∞_–Ω–æ–º–µ—Ä = –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞.weekday()
    –¥–Ω–∏_–Ω–µ–¥–µ–ª–∏ = {
        0: "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
        1: "–í—Ç–æ—Ä–Ω–∏–∫", 
        2: "–°—Ä–µ–¥–∞",
        3: "–ß–µ—Ç–≤–µ—Ä–≥",
        4: "–ü—è—Ç–Ω–∏—Ü–∞",
        5: "–°—É–±–±–æ—Ç–∞",
        6: "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"
    }
    –∑–∞–≤—Ç—Ä–∞_–¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏ = –¥–Ω–∏_–Ω–µ–¥–µ–ª–∏.get(–∑–∞–≤—Ç—Ä–∞_–Ω–æ–º–µ—Ä, "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫")
    
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–∑–∞–≤—Ç—Ä–∞_–¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏, –¥–ª—è_–¥–∞—Ç—ã=–∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞)
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("week"))
async def week_cmd(message: types.Message):
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–µ"""
    –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é_–æ_–Ω–µ–¥–µ–ª–µ()
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("numer"))
async def numer_cmd(message: types.Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —á–∏—Å–ª–∏—Ç–µ–ª—è"""
    –¥–µ–Ω—å = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ(–¥–µ–Ω—å, "—á–∏—Å–ª–∏—Ç–µ–ª—å")
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("denom"))
async def denom_cmd(message: types.Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è"""
    –¥–µ–Ω—å = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ(–¥–µ–Ω—å, "–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å")
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("subscribe"))
async def subscribe_cmd(message: types.Message):
    """–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É"""
    user_id = message.from_user.id
    
    db.add_subscriber(
        user_id=user_id,
        username=message.from_user.username,
        first_name=message.from_user.first_name,
        last_name=message.from_user.last_name
    )
    
    —Ç–µ–∫—Å—Ç = (
        "‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É!\n\n"
        "‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 7:00 —É—Ç—Ä–∞.\n\n"
        "üìÖ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –°–ï–ì–û–î–ù–Ø–®–ù–ò–ô –¥–µ–Ω—å."
    )
    
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("unsubscribe"))
async def unsubscribe_cmd(message: types.Message):
    """–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏"""
    user_id = message.from_user.id
    
    if db.remove_subscriber(user_id):
        —Ç–µ–∫—Å—Ç = "ü•∫ –í—ã –æ—Ç–ø–∏—Å–∞–ª–∏—Å—å –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏.\n\nüîî –ß—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /subscribe"
    else:
        —Ç–µ–∫—Å—Ç = "‚ÑπÔ∏è –í—ã –Ω–µ –±—ã–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É."
    
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("test_vremi"))
async def test_vremi_cmd(message: types.Message):
    —Å–µ–π—á–∞—Å = datetime.now()
    —Å–µ–π—á–∞—Å_–ø–æ_–º—Å–∫ = —Å–µ–π—á–∞—Å + timedelta(hours=3)
    await message.answer(f"‚è∞ –í—Ä–µ–º—è: {—Å–µ–π—á–∞—Å.strftime('%H:%M:%S')}\nüìÖ –î–∞—Ç–∞: {—Å–µ–π—á–∞—Å.strftime('%d.%m.%Y')}")

# ============ –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–û–ö ============

@dp.message()
async def text_handler(message: types.Message):
    —Ç–µ–∫—Å—Ç = message.text.lower()
    
    # –†–∞—Å—Å—ã–ª–∫–∞
    if —Ç–µ–∫—Å—Ç == "üîî —Ä–∞—Å—Å—ã–ª–∫–∞" or "—Ä–∞—Å—Å—ã–ª–∫–∞" in —Ç–µ–∫—Å—Ç:
        user_id = message.from_user.id
        if db.is_subscriber(user_id):
            –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = db.get_subscribers_count()
            —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç = (
                f"üîî **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–æ–π**\n\n"
                f"‚úÖ –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É.\n\n"
                f"üë• –í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ}\n\n"
                f"‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ 7:00 —É—Ç—Ä–∞.\n"
                f"–ß—Ç–æ–±—ã –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è: /unsubscribe"
            )
        else:
            —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç = (
                "üîî **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–æ–π**\n\n"
                "‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É.\n\n"
                "–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!\n\n"
                "–ß—Ç–æ–±—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è: /subscribe"
            )
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
        return
    
    # –ü–æ–º–æ—â—å
    elif —Ç–µ–∫—Å—Ç == "‚ùì –ø–æ–º–æ—â—å" or —Ç–µ–∫—Å—Ç == "–ø–æ–º–æ—â—å":
        await help_cmd(message)
        return
    
    # –°–µ–≥–æ–¥–Ω—è
    elif —Ç–µ–∫—Å—Ç == "üìÖ —Å–µ–≥–æ–¥–Ω—è" or —Ç–µ–∫—Å—Ç == "—Å–µ–≥–æ–¥–Ω—è":
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å()
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # –ó–∞–≤—Ç—Ä–∞
    elif —Ç–µ–∫—Å—Ç == "üìÖ –∑–∞–≤—Ç—Ä–∞" or —Ç–µ–∫—Å—Ç == "–∑–∞–≤—Ç—Ä–∞":
        –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞ = datetime.now() + timedelta(days=1)
        
        # –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
        –∑–∞–≤—Ç—Ä–∞_–Ω–æ–º–µ—Ä = –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞.weekday()
        –¥–Ω–∏_–Ω–µ–¥–µ–ª–∏ = {
            0: "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
            1: "–í—Ç–æ—Ä–Ω–∏–∫", 
            2: "–°—Ä–µ–¥–∞",
            3: "–ß–µ—Ç–≤–µ—Ä–≥",
            4: "–ü—è—Ç–Ω–∏—Ü–∞",
            5: "–°—É–±–±–æ—Ç–∞",
            6: "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"
        }
        –∑–∞–≤—Ç—Ä–∞_–¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏ = –¥–Ω–∏_–Ω–µ–¥–µ–ª–∏.get(–∑–∞–≤—Ç—Ä–∞_–Ω–æ–º–µ—Ä, "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫")
        
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–∑–∞–≤—Ç—Ä–∞_–¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏, –¥–ª—è_–¥–∞—Ç—ã=–∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # –ß–∏—Å–ª–∏—Ç–µ–ª—å
    elif —Ç–µ–∫—Å—Ç == "üîµ —á–∏—Å–ª–∏—Ç–µ–ª—å" or —Ç–µ–∫—Å—Ç == "—á–∏—Å–ª–∏—Ç–µ–ª—å":
        –¥–µ–Ω—å = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ(–¥–µ–Ω—å, "—á–∏—Å–ª–∏—Ç–µ–ª—å")
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å
    elif —Ç–µ–∫—Å—Ç == "üî¥ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å" or —Ç–µ–∫—Å—Ç == "–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å":
        –¥–µ–Ω—å = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ(–¥–µ–Ω—å, "–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å")
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # –ò–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ
    elif —Ç–µ–∫—Å—Ç == "üìä –∏–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ" or "–Ω–µ–¥–µ–ª—è" in —Ç–µ–∫—Å—Ç:
        –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é_–æ_–Ω–µ–¥–µ–ª–µ()
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # –î–Ω–∏ –Ω–µ–¥–µ–ª–∏
    elif —Ç–µ–∫—Å—Ç == "–ø–Ω":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("–ø–Ω")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç == "–≤—Ç":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("–≤—Ç")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–í—Ç–æ—Ä–Ω–∏–∫", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç == "—Å—Ä":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("—Å—Ä")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–°—Ä–µ–¥–∞", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç == "—á—Ç":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("—á—Ç")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–ß–µ—Ç–≤–µ—Ä–≥", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç == "–ø—Ç":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("–ø—Ç")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–ü—è—Ç–Ω–∏—Ü–∞", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç == "—Å–±":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("—Å–±")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–°—É–±–±–æ—Ç–∞", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç == "–≤—Å":
        –¥–∞—Ç–∞ = –ø–æ–ª—É—á–∏—Ç—å_–¥–∞—Ç—É_–¥–ª—è_–¥–Ω—è_–Ω–µ–¥–µ–ª–∏("–≤—Å")
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å("–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", –¥–ª—è_–¥–∞—Ç—ã=–¥–∞—Ç–∞)
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # –î—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã
    elif "–ø–∞—Ä—ã" in —Ç–µ–∫—Å—Ç or "—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ" in —Ç–µ–∫—Å—Ç:
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å()
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    else:
        —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç = (
            "ü§î –ù–µ –ø–æ–Ω—è–ª –∑–∞–ø—Ä–æ—Å.\n\n"
            "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ:\n"
            "/today - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
            "/tomorrow - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n"
            "/week - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–µ\n"
            "/numer - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —á–∏—Å–ª–∏—Ç–µ–ª—è\n"
            "/denom - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è\n"
            "/subscribe - –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É\n"
            "/unsubscribe - –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏"
        )
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_—É–¥–∞–ª—è–µ–º–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ(message, —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

# ============ –ó–ê–ü–£–°–ö ============

async def main():
    print("=" * 50)
    print("ü§ñ –ë–æ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    print(f"üìÅ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {os.getcwd()}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = db.get_subscribers_count()
    print(f"‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞. –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ}")
    
    # –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
    —Å–µ–≥–æ–¥–Ω—è = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
    –Ω–µ–¥–µ–ª—è = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—É—â—É—é_–Ω–µ–¥–µ–ª—é()
    print(f"üìÖ –°–µ–≥–æ–¥–Ω—è: {—Å–µ–≥–æ–¥–Ω—è} ({–Ω–µ–¥–µ–ª—è})")
    
    print("\nüöÄ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    print("=" * 50)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    asyncio.create_task(–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫_—Ä–∞—Å—Å—ã–ª–∫–∏())
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    await dp.start_polling(bot)

if __name__ == '__main__':
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("\nüëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
    except Exception as e:
        print(f"\nüí• –û—à–∏–±–∫–∞: {e}")