# bot.py - —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Render
import asyncio
import logging
from datetime import datetime
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from config import BOT_TOKEN
from excel_parser import –ü–∞—Ä—Å–µ—Ä–†–∞—Å–ø–∏—Å–∞–Ω–∏—è
from database import db

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω
if BOT_TOKEN == "NOT_SET":
    logger.warning("‚ö†Ô∏è  –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –±–µ–∑ —Ç–æ–∫–µ–Ω–∞! –†–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç!")
    logger.warning("‚ö†Ô∏è  –ù–∞ Render –¥–æ–±–∞–≤—å—Ç–µ BOT_TOKEN –≤ Environment Variables")
else:
    logger.info(f"‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω: {BOT_TOKEN[:10]}...")

# –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω
if BOT_TOKEN and BOT_TOKEN != "NOT_SET":
    bot = Bot(token=BOT_TOKEN)
    dp = Dispatcher()
else:
    # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
    bot = None
    dp = None

# –°–æ–∑–¥–∞–µ–º –ø–∞—Ä—Å–µ—Ä
–ø–∞—Ä—Å–µ—Ä = –ü–∞—Ä—Å–µ—Ä–†–∞—Å–ø–∏—Å–∞–Ω–∏—è()

# ============ –ö–õ–ê–í–ò–ê–¢–£–†–´ ============

def —Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É():
    """–°–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏"""
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [
                KeyboardButton(text="üìÖ –°–µ–≥–æ–¥–Ω—è"),
                KeyboardButton(text="üìÖ –ó–∞–≤—Ç—Ä–∞")
            ],
            [
                KeyboardButton(text="üîµ –ß–∏—Å–ª–∏—Ç–µ–ª—å"),
                KeyboardButton(text="üî¥ –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å"),
                KeyboardButton(text="üìä –ò–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ")
            ],
            [
                KeyboardButton(text="üîÑ –ó–∞–º–µ–Ω—ã"),
                KeyboardButton(text="üîî –†–∞—Å—Å—ã–ª–∫–∞"),
                KeyboardButton(text="‚ùì –ü–æ–º–æ—â—å")
            ],
            [
                KeyboardButton(text="–ü–Ω"),
                KeyboardButton(text="–í—Ç"),
                KeyboardButton(text="–°—Ä"),
                KeyboardButton(text="–ß—Ç"),
                KeyboardButton(text="–ü—Ç"),
                KeyboardButton(text="–°–±"),
                KeyboardButton(text="–í—Å")
            ]
        ],
        resize_keyboard=True,
        input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ"
    )
    return keyboard

# ============ –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê ============

@dp.message(Command("start"))
async def start_cmd(message: types.Message):
    """–ö–æ–º–∞–Ω–¥–∞ /start"""
    user_id = message.from_user.id
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏
    db.add_subscriber(
        user_id=user_id,
        username=message.from_user.username,
        first_name=message.from_user.first_name,
        last_name=message.from_user.last_name
    )
    
    –∑–∞–≥–æ–ª–æ–≤–æ–∫ = "ü§ñ –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –¥–ª—è –ò–°1-21/–ò–°1-22\n\n" \
                "üìÖ –ü–æ–∫–∞–∑—ã–≤–∞—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä\n" \
                "üîÑ –°–ª–µ–∂—É –∑–∞ –∑–∞–º–µ–Ω–∞–º–∏ —Å —Å–∞–π—Ç–∞ sttec\n" \
                "üîî –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –≤ 7:00\n\n" \
                "üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã!"
    
    await message.answer(–∑–∞–≥–æ–ª–æ–≤–æ–∫, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("help"))
async def help_cmd(message: types.Message):
    —Ç–µ–∫—Å—Ç = (
        "üìö **–ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:**\n\n"
        "üí° **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\n"
        "/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "/today - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
        "/tomorrow - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞\n"
        "/week - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–µ–¥–µ–ª–µ\n"
        "/numer - —á–∏—Å–ª–∏—Ç–µ–ª—å\n"
        "/denom - –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å\n\n"
        "üí° **–ö–Ω–æ–ø–∫–∏:**\n"
        "‚Ä¢ üìÖ –°–µ–≥–æ–¥–Ω—è/–ó–∞–≤—Ç—Ä–∞ - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ\n"
        "‚Ä¢ üîµ/üî¥ - —á–∏—Å–ª–∏—Ç–µ–ª—å/–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å\n"
        "‚Ä¢ üìä –ò–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ\n"
        "‚Ä¢ üîÑ –ó–∞–º–µ–Ω—ã - –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–º–µ–Ω—ã\n"
        "‚Ä¢ üîî –†–∞—Å—Å—ã–ª–∫–∞ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π\n"
        "‚Ä¢ –ü–Ω-–í—Å - –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏\n\n"
        "üîî **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞:**\n"
        "‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 7:00 - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å"
    )
    await message.answer(—Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("today"))
async def today_cmd(message: types.Message):
    """–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"""
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_—Å_–∑–∞–º–µ–Ω–∞–º–∏()
    await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("tomorrow"))
async def tomorrow_cmd(message: types.Message):
    """–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞"""
    –¥–Ω–∏ = –ø–∞—Ä—Å–µ—Ä.–¥–Ω–∏_–Ω–µ–¥–µ–ª–∏
    —Å–µ–≥–æ–¥–Ω—è = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
    
    –Ω–æ–º–µ—Ä_—Å–µ–≥–æ–¥–Ω—è = None
    for –Ω–æ–º–µ—Ä, –¥–µ–Ω—å in –¥–Ω–∏.items():
        if –¥–µ–Ω—å == —Å–µ–≥–æ–¥–Ω—è:
            –Ω–æ–º–µ—Ä_—Å–µ–≥–æ–¥–Ω—è = –Ω–æ–º–µ—Ä
            break
    
    if –Ω–æ–º–µ—Ä_—Å–µ–≥–æ–¥–Ω—è is not None:
        –∑–∞–≤—Ç—Ä–∞_–Ω–æ–º–µ—Ä = (–Ω–æ–º–µ—Ä_—Å–µ–≥–æ–¥–Ω—è + 1) % 7
        –∑–∞–≤—Ç—Ä–∞_–¥–µ–Ω—å = –¥–Ω–∏.get(–∑–∞–≤—Ç—Ä–∞_–Ω–æ–º–µ—Ä, "–ó–∞–≤—Ç—Ä–∞")
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –∑–∞–≤—Ç—Ä–∞
        –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞ = datetime.now().replace(hour=0, minute=0, second=0, microsecond=0)
        from datetime import timedelta
        –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞ = –∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞ + timedelta(days=1)
        
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_—Å_–∑–∞–º–µ–Ω–∞–º–∏(–∑–∞–≤—Ç—Ä–∞_–¥–µ–Ω—å, –¥–ª—è_–¥–∞—Ç—ã=–∑–∞–≤—Ç—Ä–∞_–¥–∞—Ç–∞)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    else:
        await message.answer("‚ùå –ù–µ –º–æ–≥—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–≤—Ç—Ä–∞", reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("week"))
async def week_cmd(message: types.Message):
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–µ–¥–µ–ª–µ"""
    –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é_–æ_–Ω–µ–¥–µ–ª–µ()
    await message.answer(–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("numer"))
async def numer_cmd(message: types.Message):
    """–ß–∏—Å–ª–∏—Ç–µ–ª—å"""
    –¥–µ–Ω—å = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ(–¥–µ–Ω—å, "—á–∏—Å–ª–∏—Ç–µ–ª—å")
    await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("denom"))
async def denom_cmd(message: types.Message):
    """–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å"""
    –¥–µ–Ω—å = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π_–¥–µ–Ω—å()
    —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ(–¥–µ–Ω—å, "–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å")
    await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("subscribe"))
async def subscribe_cmd(message: types.Message):
    """–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É"""
    user_id = message.from_user.id
    
    db.add_subscriber(
        user_id=user_id,
        username=message.from_user.username,
        first_name=message.from_user.first_name,
        last_name=message.from_user.last_name
    )
    
    —Ç–µ–∫—Å—Ç = "‚úÖ –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é —Ä–∞—Å—Å—ã–ª–∫—É –≤ 7:00!"
    await message.answer(—Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

@dp.message(Command("unsubscribe"))
async def unsubscribe_cmd(message: types.Message):
    """–û—Ç–ø–∏—Å–∫–∞ –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏"""
    user_id = message.from_user.id
    
    if db.remove_subscriber(user_id):
        —Ç–µ–∫—Å—Ç = "‚ùå –í—ã –æ—Ç–ø–∏—Å–∞–Ω—ã –æ—Ç —Ä–∞—Å—Å—ã–ª–∫–∏."
    else:
        —Ç–µ–∫—Å—Ç = "‚ÑπÔ∏è –í—ã –Ω–µ –±—ã–ª–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã."
    
    await message.answer(—Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

# ============ –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–û–ö ============

@dp.message()
async def text_handler(message: types.Message):
    —Ç–µ–∫—Å—Ç = message.text.lower()
    
    # üìÖ –°–µ–≥–æ–¥–Ω—è
    if —Ç–µ–∫—Å—Ç == "üìÖ —Å–µ–≥–æ–¥–Ω—è" or —Ç–µ–∫—Å—Ç == "—Å–µ–≥–æ–¥–Ω—è":
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_—Å_–∑–∞–º–µ–Ω–∞–º–∏()
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # üìÖ –ó–∞–≤—Ç—Ä–∞
    elif —Ç–µ–∫—Å—Ç == "üìÖ –∑–∞–≤—Ç—Ä–∞" or —Ç–µ–∫—Å—Ç == "–∑–∞–≤—Ç—Ä–∞":
        await tomorrow_cmd(message)
    
    # üîµ –ß–∏—Å–ª–∏—Ç–µ–ª—å
    elif —Ç–µ–∫—Å—Ç == "üîµ —á–∏—Å–ª–∏—Ç–µ–ª—å" or —Ç–µ–∫—Å—Ç == "—á–∏—Å–ª–∏—Ç–µ–ª—å":
        await numer_cmd(message)
    
    # üî¥ –ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å
    elif —Ç–µ–∫—Å—Ç == "üî¥ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å" or —Ç–µ–∫—Å—Ç == "–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å":
        await denom_cmd(message)
    
    # üìä –ò–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ
    elif —Ç–µ–∫—Å—Ç == "üìä –∏–Ω—Ñ–æ –æ –Ω–µ–¥–µ–ª–µ" or "–Ω–µ–¥–µ–ª—è" in —Ç–µ–∫—Å—Ç:
        await week_cmd(message)
    
    # üîÑ –ó–∞–º–µ–Ω—ã
    elif —Ç–µ–∫—Å—Ç == "üîÑ –∑–∞–º–µ–Ω—ã" or —Ç–µ–∫—Å—Ç == "–∑–∞–º–µ–Ω—ã":
        # –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è - –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å–∞–π—Ç–∞
        if –ø–∞—Ä—Å–µ—Ä.–µ—Å—Ç—å_–∑–∞–º–µ–Ω—ã():
            —Ç–µ–∫—Å—Ç_–∑–∞–º–µ–Ω = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ç–µ–∫—Å—Ç_–∑–∞–º–µ–Ω()
        else:
            —Ç–µ–∫—Å—Ç_–∑–∞–º–µ–Ω = "üìù –ó–∞–º–µ–Ω –Ω–µ—Ç –∏–ª–∏ –µ—â–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å\n" \
                         "–ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é: /update"
        await message.answer(—Ç–µ–∫—Å—Ç_–∑–∞–º–µ–Ω, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # üîî –†–∞—Å—Å—ã–ª–∫–∞
    elif —Ç–µ–∫—Å—Ç == "üîî —Ä–∞—Å—Å—ã–ª–∫–∞" or "—Ä–∞—Å—Å—ã–ª–∫–∞" in —Ç–µ–∫—Å—Ç:
        user_id = message.from_user.id
        if db.is_subscriber(user_id):
            —Ç–µ–∫—Å—Ç = f"‚úÖ –í—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É!\n–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {db.get_subscribers_count()}"
        else:
            —Ç–µ–∫—Å—Ç = "‚ùå –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã. –ù–∞–∂–º–∏—Ç–µ /subscribe"
        await message.answer(—Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    # ‚ùì –ü–æ–º–æ—â—å
    elif —Ç–µ–∫—Å—Ç == "‚ùì –ø–æ–º–æ—â—å" or —Ç–µ–∫—Å—Ç == "–ø–æ–º–æ—â—å":
        await help_cmd(message)
    
    # –î–Ω–∏ –Ω–µ–¥–µ–ª–∏
    elif —Ç–µ–∫—Å—Ç in ["–ø–Ω", "–ø–æ–Ω", "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫"]:
        –¥–µ–Ω—å = "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç in ["–≤—Ç", "–≤—Ç—Ä", "–≤—Ç–æ—Ä–Ω–∏–∫"]:
        –¥–µ–Ω—å = "–í—Ç–æ—Ä–Ω–∏–∫"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç in ["—Å—Ä", "—Å—Ä–¥", "—Å—Ä–µ–¥–∞"]:
        –¥–µ–Ω—å = "–°—Ä–µ–¥–∞"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç in ["—á—Ç", "—á—Ç–≤", "—á–µ—Ç–≤–µ—Ä–≥"]:
        –¥–µ–Ω—å = "–ß–µ—Ç–≤–µ—Ä–≥"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç in ["–ø—Ç", "–ø—Ç–Ω", "–ø—è—Ç–Ω–∏—Ü–∞"]:
        –¥–µ–Ω—å = "–ü—è—Ç–Ω–∏—Ü–∞"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç in ["—Å–±", "—Å–±—Ç", "—Å—É–±–±–æ—Ç–∞"]:
        –¥–µ–Ω—å = "–°—É–±–±–æ—Ç–∞"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    elif —Ç–µ–∫—Å—Ç in ["–≤—Å", "–≤—Å–∫", "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"]:
        –¥–µ–Ω—å = "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"
        —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ = –ø–∞—Ä—Å–µ—Ä.–ø–æ–ª—É—á–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ_–Ω–∞_–¥–µ–Ω—å(–¥–µ–Ω—å)
        await message.answer(—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())
    
    else:
        —Ç–µ–∫—Å—Ç = "ü§î –ù–µ –ø–æ–Ω—è–ª –∑–∞–ø—Ä–æ—Å. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ /help"
        await message.answer(—Ç–µ–∫—Å—Ç, reply_markup=—Å–æ–∑–¥–∞—Ç—å_–æ—Å–Ω–æ–≤–Ω—É—é_–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É())

# ============ –ó–ê–ü–£–°–ö –ë–û–¢–ê ============

async def main():
    print("=" * 50)
    print("ü§ñ –ë–û–¢ –î–õ–Ø RENDER - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø")
    print("=" * 50)
    
    if BOT_TOKEN == "NOT_SET":
        print("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
        print("‚ùå –ë–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Ç–æ–∫–µ–Ω–∞")
        print("‚ùå –ù–∞ Render –¥–æ–±–∞–≤—å—Ç–µ BOT_TOKEN –≤ Environment Variables")
        print("‚ùå –ó–∞–ø—É—Å–∫–∞—é –≤ —Ä–µ–∂–∏–º–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...")
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —á—Ç–æ–±—ã Render –Ω–µ –¥—É–º–∞–ª —á—Ç–æ –±–æ—Ç —É–ø–∞–ª
        while True:
            print("‚ö†Ô∏è  –û–∂–∏–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞... (–∑–∞–≥–ª—É—à–∫–∞)")
            await asyncio.sleep(60)
        return
    
    print("‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω")
    print("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞...")
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    –ø–∞—Ä—Å–µ—Ä.–∑–∞–≥—Ä—É–∑–∏—Ç—å_—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ()
    
    print("‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ")
    print(f"‚úÖ –ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤: {db.get_subscribers_count()}")
    print("=" * 50)
    print("üöÄ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
    print("üí° –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∞: /start")
    print("=" * 50)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    try:
        await dp.start_polling(bot)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")
        print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...")
        await asyncio.sleep(5)

if __name__ == '__main__':
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å aiogram
    try:
        import aiogram
        print(f"‚úÖ Aiogram –≤–µ—Ä—Å–∏—è: {aiogram.__version__}")
    except ImportError as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ aiogram: {e}")
        print("‚ùå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install aiogram")
        exit(1)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    asyncio.run(main())